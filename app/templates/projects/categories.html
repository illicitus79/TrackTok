{% extends "base.html" %}

{% block title %}Categories - {{ project.name }}{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem 0;">
  <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
    <div>
      <div class="breadcrumb" style="margin-bottom: 0.5rem;">
        <a href="{{ url_for('web.projects') }}">Projects</a>
        <span>/</span>
        <a href="{{ url_for('web.project_detail', project_id=project.id) }}">{{ project.name }}</a>
        <span>/</span>
        <span>Categories</span>
      </div>
      <h1 style="margin: 0; font-size: 2rem;">Categories</h1>
      <p style="color: var(--text-muted); margin: 0.25rem 0 0;">Only used within {{ project.name }}.</p>
    </div>
    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
      <a class="btn btn-secondary" href="{{ url_for('web.project_detail', project_id=project.id) }}">Back to Project</a>
    </div>
  </div>

  <div class="card" style="margin-bottom: 1rem;">
    <div class="card-body">
      <h3 style="margin-top: 0;">New Category</h3>
      <form method="POST" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 0.75rem; align-items: end;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div>
          <label class="form-label" for="name">Name</label>
          <input class="form-input" type="text" id="name" name="name" placeholder="Design, Ops" required>
        </div>
        <div>
          <label class="form-label" for="color">Color</label>
          <input class="form-input" type="text" id="color" name="color" value="#6366F1" maxlength="7" required>
          <div class="form-hint">Hex color (e.g., #6366F1).</div>
        </div>
        <div>
          <label class="form-label" for="icon">Icon</label>
          <input class="form-input" type="text" id="icon" name="icon" placeholder="ðŸš€ or fe-icon" maxlength="10">
          <div class="form-hint">Optional emoji or short icon code.</div>
        </div>
        <div>
          <label class="form-label" for="description">Description</label>
          <input class="form-input" type="text" id="description" name="description" placeholder="Optional note">
        </div>
        <div style="display: flex; gap: 0.75rem; justify-content: flex-end;">
          <button type="submit" class="btn btn-primary">Create</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h3 style="margin-top: 0;">Existing Categories</h3>
      {% if categories %}
      <div style="overflow-x: auto;">
        <table class="table" style="width: 100%; border-collapse: collapse; min-width: 720px;">
          <thead>
            <tr style="text-align: left; border-bottom: 1px solid var(--border);">
              <th style="padding: 0.75rem 0.5rem;">Name</th>
              <th style="padding: 0.75rem 0.5rem;">Icon</th>
              <th style="padding: 0.75rem 0.5rem;">Color</th>
              <th style="padding: 0.75rem 0.5rem;">Description</th>
              <th style="padding: 0.75rem 0.5rem;">Active</th>
              <th style="padding: 0.75rem 0.5rem;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for category in categories %}
            <form method="POST" action="{{ url_for('web.project_category_update', project_id=project.id, category_id=category.id) }}" style="display: contents;">
              <tr style="border-bottom: 1px solid var(--border);">
                <td style="padding: 0.75rem 0.5rem;">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input class="form-input" type="text" name="name" value="{{ category.name }}" required>
                </td>
                <td style="padding: 0.75rem 0.5rem;">
                  <input class="form-input" type="text" name="icon" value="{{ category.icon or '' }}" maxlength="10">
                </td>
                <td style="padding: 0.75rem 0.5rem;">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span style="width: 14px; height: 14px; border-radius: 4px; display: inline-block; background: {{ category.color }};"></span>
                    <input class="form-input" type="text" name="color" value="{{ category.color }}" maxlength="7" required>
                  </div>
                </td>
                <td style="padding: 0.75rem 0.5rem;">
                  <input class="form-input" type="text" name="description" value="{{ category.description or '' }}">
                </td>
                <td style="padding: 0.75rem 0.5rem;">
                  <div style="display: flex; align-items: center; gap: 0.25rem;">
                    <input type="checkbox" id="active_{{ category.id }}" name="is_active" {% if category.is_active %}checked{% endif %}>
                    <label for="active_{{ category.id }}" style="color: var(--text-muted);">Active</label>
                  </div>
                </td>
                <td style="padding: 0.75rem 0.5rem; text-align: right;">
                  <button type="submit" class="btn btn-secondary btn-sm">Save</button>
                </td>
              </tr>
            </form>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p style="color: var(--text-muted); margin: 0;">No categories yet. Create your first category above.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
