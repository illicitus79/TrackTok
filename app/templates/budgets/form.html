{% extends "base.html" %}

{% if mode == "edit" %}
  {% set page_title = "Edit Budget" %}
{% else %}
  {% set page_title = "New Budget" %}
{% endif %}

{% block title %}{{ page_title }} - TrackTok{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem 0; max-width: 780px;">
  <h1 style="margin: 0 0 1rem 0; font-size: 2rem;">{{ page_title }}</h1>
  <div class="card">
    <div class="card-body">
      <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-group">
          <label class="form-label" for="name">Name</label>
          <input class="form-input" type="text" id="name" name="name" required value="{{ budget.name if budget else '' }}" placeholder="Q1 Marketing Budget" />
        </div>

        <div class="form-group">
          <label class="form-label" for="description">Description</label>
          <textarea class="form-input" id="description" name="description" rows="2" placeholder="Optional description">{{ budget.description if budget else '' }}</textarea>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="amount">Amount <span class="required">*</span></label>
            <input class="form-input" type="number" step="0.01" id="amount" name="amount" required value="{{ budget.amount if budget else '' }}" />
          </div>
          <div class="form-group">
            <label class="form-label" for="currency">Currency</label>
            <input class="form-input" type="text" id="currency" name="currency" value="{{ tenant_currency }}" readonly />
            <div class="form-hint">Currency follows tenant settings.</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="period">Period</label>
            <select class="form-input" id="period" name="period">
              {% set current_period = budget.period if budget else 'monthly' %}
              {% for p in ['daily','weekly','monthly','quarterly','yearly','custom'] %}
              <option value="{{ p }}" {% if current_period == p %}selected{% endif %}>{{ p|capitalize }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="start_date">Start Date</label>
            <input
              class="form-input"
              type="text"
              inputmode="numeric"
              id="start_date"
              name="start_date"
              required
              value="{{ format_date(budget.start_date) if budget and budget.start_date else '' }}"
              placeholder="{{ date_format }}"
            />
            <div class="form-hint">Format: {{ date_format }}</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="end_date">End Date</label>
            <input
              class="form-input"
              type="text"
              inputmode="numeric"
              id="end_date"
              name="end_date"
              required
              value="{{ format_date(budget.end_date) if budget and budget.end_date else '' }}"
              placeholder="{{ date_format }}"
            />
            <div class="form-hint">Format: {{ date_format }}</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="category_id">Category</label>
            <select class="form-input" id="category_id" name="category_id">
              <option value="">All categories</option>
              {% for category in categories %}
              <option value="{{ category.id }}" {% if budget and budget.category_id == category.id %}selected{% endif %}>{{ category.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="alert_threshold">Alert Threshold (%)</label>
            <input class="form-input" type="number" id="alert_threshold" name="alert_threshold" value="{{ budget.alert_threshold if budget else 80 }}" min="0" max="100" />
          </div>
          <div class="form-group">
            <label class="form-label" for="alert_enabled">Alerts Enabled</label>
            <input type="checkbox" id="alert_enabled" name="alert_enabled" {% if not budget or budget.alert_enabled %}checked{% endif %} />
          </div>
        </div>

        <div style="display: flex; justify-content: flex-end; gap: 0.75rem; margin-top: 1rem;">
          <a class="btn btn-secondary" href="{{ url_for('web.budgets') }}">Cancel</a>
          <button type="submit" class="btn btn-primary">Save Budget</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
